# QuarkChain æŒ–çŸ¿æ•™ç¨‹
ç®€å•ç½²QuarkChain ä¸»ç½‘1.1.1 æŒ–çŸ¿è„šæœ¬ â€œäº‘æŒ–çŸ¿ç‰ˆæœ¬â€

è¦éƒ¨ç½²macOS ç‰ˆæœ¬[çœ‹è¿™é‡Œ](https://github.com/HangyuYe/QKC-Miner/tree/master/mac)
è¦éƒ¨ç½²Linux ç‰ˆæœ¬[çœ‹è¿™é‡Œ](https://github.com/HangyuYe/QKC-Miner/tree/master/linux)


å¤šå›¾æ…å…¥

## æ­å»ºä¸€ä¸ªäº‘æœåŠ¡å™¨
* é€‰æ‹©ä»»æ„ä¸€ä¸ªäº‘æœåŠ¡å™¨æä¾›å•†ï¼Œå»ºè®®é€‰æ‹©å›½å¤–çš„ï¼Œæˆ–è€…ä½¿ç”¨å›½å†…æœåŠ¡å•†æä¾›çš„å›½å¤–æœåŠ¡å™¨ã€‚
* æœ€ä½è¦æ±‚ï¼š2 vCPUï¼Œ4 GBå†…å­˜ï¼Œ100 GBçš„ç¡¬ç›˜å­˜å‚¨ç©ºé—´
* å»ºè®®ç³»ç»Ÿï¼šUbuntu 18ä»¥ä¸Šã€‚
* å½“ç„¶æ€§èƒ½è¶Šé«˜ï¼ŒæŒ–çŸ¿çš„æ•ˆç‡è¶Šé«˜ï¼Œå»ºè®®å†…å­˜æ˜¯æ ¸å¿ƒæ•°çš„4å€ã€‚ï¼ˆç›®å‰æŒ–çŸ¿æ²¡æœ‰å›æŠ¥ï¼Œæ‰€ä»¥é‡åŠ›è€Œè¡Œï¼‰

* ä¾›åº”å•†ï¼šã€å›½å†…ï¼šè…¾è®¯äº‘ï¼Œé˜¿é‡Œäº‘ï¼Œç™¾åº¦äº‘ï¼Œåä¸ºäº‘ã€‘ï¼Œã€å›½å¤–ï¼šAWSï¼ŒGoogle Cloudï¼ˆé¦–æ¬¡æ³¨å†Œæœ‰ US$300çš„ç°é‡‘å¯ç”¨ï¼‰ã€‘
* æ³¨å†Œæ–¹æ³•æˆ‘ä»¬å·²è…¾è®¯äº‘ä¸ºä¾‹ï¼Œå…¶ä»–å®¶å·®ä¸å¤šã€‚

## æˆ‘ä»¬ä»¥è…¾è®¯äº‘ä¸ºä¾‹
é¦–å…ˆæˆ‘ä»¬æ‰“å¼€è…¾è®¯äº‘çš„[å®˜ç½‘](https://cloud.tencent.com)
* é€‰æ‹©äº‘æœåŠ¡å™¨
![å›¾1.png](https://upload-images.jianshu.io/upload_images/15372740-e283e0683a448935.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* è´­ä¹°ä¸€ä¸ªæ–°çš„æœåŠ¡å™¨ï¼Œé€‰æ‹©è‡ªå®šä¹‰é…ç½®
![å›¾2](https://upload-images.jianshu.io/upload_images/15372740-e1b770c6df642840.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
**æŒ‰é‡è®¡è´¹æ˜¯æŒ‰ç…§ä½ ä½¿ç”¨çš„æ—¶é—´ï¼ˆæŒ‰ç§’æ¥ç®—ï¼‰æ¥è®¡ç®—ä»·é’±ï¼ŒåœŸè±ªå¯ä»¥é€‰æ‹©æŒ‰æœˆä»˜è´¹ï¼Œæ€§èƒ½è¶Šå¥½ä»·æ ¼è¶Šè´µï¼Œå»ºè®®é€‰æ‹©å†…å­˜å‹æˆ–è€…è®¡ç®—å‹çš„æœºå™¨ã€‚**

* è¿™é‡Œæˆ‘ä»¬å·²ä¸€ä¸ªæ ‡å‡†å‹çš„åŒæ ¸4GBå†…å­˜ä¸ºä¾‹ï¼Œä»·æ ¼æ˜¯0.43æœˆæ¯å°æ—¶ã€‚
![å›¾3](https://upload-images.jianshu.io/upload_images/15372740-49e781559db4655c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* é€‰æ‹©ç³»ç»Ÿæˆ‘ä»¬é€‰Ubuntu 64ä½çš„ã€‚
![å›¾4](https://upload-images.jianshu.io/upload_images/15372740-0cc520f219f89752.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* æ¥ä¸‹æ¥æ˜¯â€œé€‰é…â€å†…å®¹ï¼Œç½‘ç»œæˆ‘ä»¬å¯ä»¥é€‰æ‹©æŒ‰æµé‡è®¡è´¹ï¼Œç›¸å½“åˆ’ç®—ï¼ŒæŒ–çŸ¿è¦ä¸äº†å¤šå°‘æµé‡çš„ã€‚å¸¦å®½çš„å¤§å°ä¸ä¼šå½±å“ä»·æ ¼æ‰€ä»¥æˆ‘ä»¬å½“ç„¶é€‰æ‹©100Mã€‚
![å›¾4](https://upload-images.jianshu.io/upload_images/15372740-008f53ea90b5639b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* è®¾ç½®å®‰å…¨ç»„ï¼Œé«˜çº§ç©å®¶åªç”¨æ”¾å¼€TCP/UDP:38291ï¼Œå°ç™½ç©å®¶å°±å…¨æ”¾å§ï¼
![å›¾5](https://upload-images.jianshu.io/upload_images/15372740-d9722adf843478b9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* è®¾ç½®å¯†ç 
![å›¾6](https://upload-images.jianshu.io/upload_images/15372740-2cb4212ca6fae667.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* å®Œæˆäº†ï¼Œæœ€åç»“ç®—0.48å…ƒæ¯å°æ—¶ã€‚å½“ç„¶ä½ å¯ä»¥ä¸€æ¬¡æ€§éƒ¨ç½²å¾ˆå¤šå°ã€‚ï¼ˆç‚¹å®Œæˆä¹‹å‰è®°å¾—å…ˆå……å€¼ï¼‰
![å›¾7](https://upload-images.jianshu.io/upload_images/15372740-8d97051ae15097c6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* ç­‰å¾…åˆ›å»ºå®Œæˆä»¥åæˆ‘ä»¬ç‚¹å‡»ç™»å½•
![å›¾8](https://upload-images.jianshu.io/upload_images/15372740-44749499b9c4e7c3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

* ç„¶ååœ¨å¼¹å‡ºæ¥çš„å¯¹è¯æ¡†ä¸­é€‰æ‹©ç½‘é¡µç‰ˆï¼Œç„¶åè¾“å…¥ä½ åˆšåˆšåˆ›å»ºçš„å¯†ç ã€‚
å½“ç„¶ä½ ä¹Ÿå¯ä»¥å°è¯•ç”¨ä¸‹é¢å‡ ç§æ–¹æ³•ç™»å½•åˆ°ä½ çš„æœåŠ¡å™¨å½“ä¸­ã€‚
![å›¾9](https://upload-images.jianshu.io/upload_images/15372740-8ad6bdd95bc630c2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)
å½“ç„¶ä½ ä¹Ÿå¯ä»¥å°è¯•ç”¨ä¸‹é¢å‡ ç§æ–¹æ³•ç™»å½•åˆ°ä½ çš„æœåŠ¡å™¨å½“ä¸­ã€‚

## æ¥ä¸‹æ¥ï¼Œå°±æ˜¯å¯åŠ¨çŸ¿æœºã€‚

## æ­¥éª¤
#### å¯åŠ¨é›†ç¾¤ï¼ˆClusterï¼‰
1. å®‰è£…ç¯å¢ƒ
å¤åˆ¶ä¸‹é¢å‘½ä»¤ï¼Œç²˜è´´åˆ°å‘½ä»¤è¡Œä¸­ã€‚
``` bash
sudo wget https://qkc-miner-1256480775.cos.ap-chengdu.myqcloud.com/setup_env.sh && sudo sh setup_env.sh
```

2. å‡†å¤‡QKCåœ°å€ï¼Œæˆ–è€…ä¸€ä¸ªETHåœ°å€

è·å–QKCåœ°å€ï¼š[ä¸»ç½‘](http://mainnet.quarkchain.io/wallet)

3. å®Œæˆä»¥åä¼šè¿›å…¥åˆ°pyquarkchainçš„repoé‡Œé¢ã€‚
```bash
/code/pyquarkchain#
```
- è¾“å…¥ä¸‹é¢çš„æŒ‡ä»¤ğŸ‘‡
```bash
python3 quarkchain/tools/miner_address.py
```
- ç²˜è´´ä½ çš„ETHæˆ–è€…QKCé’±åŒ…åœ°å€æŒ‰å›è½¦ï¼
- å¯¼å‡ºæŒ–çŸ¿æ‰€ç”¨çš„æ¨¡ç‰ˆï¼Œè¾“å…¥æŒ‡ä»¤ç„¶åå›è½¦ï¼
```bash
export QKC_CONFIG=`pwd`/mainnet/singularity/cluster_config_template.json
```
- å¯åŠ¨Clusterå¼€å§‹åŒæ­¥è´¦æœ¬ä¿¡æ¯ï¼Œå¤§çº¦éœ€è¦å‡ ä¸ªå°æ—¶ï¼Œå–å†³äºæœºå™¨çš„åœ°ç†ä½ç½®ã€‚
```bash
python3 quarkchain/cluster/cluster.py --cluster_config $QKC_CONFIG
```
- è¿™ä¸ªæ—¶å€™æœºå™¨å¼€å§‹æ»šä»£ç ï¼Œçœ‹ä¸‹é¢çš„è¿™äº›å­—çœ¼ï¼Œå°±è¯´clusterå¯åŠ¨æˆåŠŸäº†ï¼Œç„¶åå°±ç­‰å¾…åŒæ­¥åŒºå—ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥å»å–ä¸€æ¯èŒ¶ï¼Œæˆ–è€…ä¸å¦¨çœ‹ä¸€é›†ç»¼è‰ºã€‚
```bash
MASTER: I0722 14:26:35.665557 root_state.py:60] Recovering root chain from local database...
MASTER: I0722 14:26:35.667544 root_state.py:256] Created genesis root block
MASTER: I0722 14:26:35.670538 master.py:792] Trying to connect 127.0.0.1:38000
MASTER: I0722 14:26:35.671606 master.py:804] Connected to 127.0.0.1:38000
MASTER: I0722 14:26:35.671985 master.py:792] Trying to connect 127.0.0.1:38001
MASTER: I0722 14:26:35.672539 master.py:804] Connected to 127.0.0.1:38001
MASTER: I0722 14:26:35.672894 master.py:792] Trying to connect 127.0.0.1:38002
MASTER: I0722 14:26:35.673468 master.py:804] Connected to 127.0.0.1:38002
MASTER: I0722 14:26:35.673775 master.py:792] Trying to connect 127.0.0.1:38003
MASTER: I0722 14:26:35.674808 master.py:804] Connected to 127.0.0.1:38003
MASTER: I0722 14:26:35.676369 master.py:961] [0/0] is run by slave [b'S0']
MASTER: I0722 14:26:35.676529 master.py:961] [4/0] is run by slave [b'S0']
MASTER: I0722 14:26:35.676805 master.py:961] [1/0] is run by slave [b'S1']
MASTER: I0722 14:26:35.676954 master.py:961] [5/0] is run by slave [b'S1']
MASTER: I0722 14:26:35.677160 master.py:961] [2/0] is run by slave [b'S2']
MASTER: I0722 14:26:35.677361 master.py:961] [6/0] is run by slave [b'S2']
MASTER: I0722 14:26:35.677553 master.py:961] [3/0] is run by slave [b'S3']
MASTER: I0722 14:26:35.677741 master.py:961] [7/0] is run by slave [b'S3']
MASTER: I0722 14:26:35.680508 master.py:506] Slave b'S1' connected to other slaves successfully
MASTER: I0722 14:26:35.682678 master.py:506] Slave b'S0' connected to other slaves successfully
MASTER: I0722 14:26:35.684604 master.py:506] Slave b'S2' connected to other slaves successfully
MASTER: I0722 14:26:35.685582 master.py:506] Slave b'S3' connected to other slaves successfully
SLAVE_S3: I0722 14:26:35.769347 shard_state.py:382] [3/0] Initialized genensis state at root block 0 4036783e441eb5057bf2be96bf1fd4585ac49824de15c0d92a4c14a97886ca51, genesis block hash b8724a90a0de184ee6f934687a43af1155bfe931a75a3c313fcc676175b02b64
SLAVE_S0: I0722 14:26:35.769361 shard_state.py:382] [4/0] Initialized genensis state at root block 0 4036783e441eb5057bf2be96bf1fd4585ac49824de15c0d92a4c14a97886ca51, genesis block hash 8cfce6ea3c685462476721f22c8ca2ab8d99bc29871b19b0e879526bebc7c5f0
SLAVE_S1: I0722 14:26:35.772444 shard_state.py:382] [1/0] Initialized genensis state at root block 0 4036783e441eb5057bf2be96bf1fd4585ac49824de15c0d92a4c14a97886ca51, genesis block hash f02644bc2de0cd5e07b1a5fc0b2843a48722cf1156f7682e46d8290c79566a4a
SLAVE_S2: I0722 14:26:35.772512 shard_state.py:382] [2/0] Initialized genensis state at root block 0 4036783e441eb5057bf2be96bf1fd4585ac49824de15c0d92a4c14a97886ca51, genesis block hash dda81fc86497cd170440a27a24e8bb6e5ac5a5fb5379eef8b9d73f4af6d092a9
SLAVE_S3: I0722 14:26:35.775670 shard_state.py:382] [7/0] Initialized genensis state at root block 0 4036783e441eb5057bf2be96bf1fd4585ac49824de15c0d92a4c14a97886ca51, genesis block hash 81fb2c87d0c334a2d936abaa1c04044524fb54b539fe9f2fd79c4c4cdf828dc0
SLAVE_S1: I0722 14:26:35.777130 shard_state.py:382] [5/0] Initialized genensis state at root block 0 4036783e441eb5057bf2be96bf1fd4585ac49824de15c0d92a4c14a97886ca51, genesis block hash 4cdde426d9d9f948784cce5f6dd9071810e42e1f20f0e4d5beac9f888ce4c2c8
SLAVE_S0: I0722 14:26:35.777562 shard_state.py:382] [0/0] Initialized genensis state at root block 0 4036783e441eb5057bf2be96bf1fd4585ac49824de15c0d92a4c14a97886ca51, genesis block hash 04493a3c06261af970ca4fc33caa585fbcef11cdb73bb1e3be2a9f6b828a7a0f
SLAVE_S2: I0722 14:26:35.779800 shard_state.py:382] [6/0] Initialized genensis state at root block 0 4036783e441eb5057bf2be96bf1fd4585ac49824de15c0d92a4c14a97886ca51, genesis block hash 26d35714cc9fca44ec2af439636cc51fdd9a9a1de7da1253e3d5c0409d7404d7
```
è¿™ä¸ªæ—¶å€™å°±å¯ä»¥å…³é—­æµè§ˆå™¨ç„¶åä¼‘æ¯ä¸€ä¼šã€‚åŒºå—æ•°æ®åœ¨10Gå·¦å³ï¼Œæ‰€ä»¥å¤§çº¦å¯ä»¥ç­‰å¾…2-3å°æ—¶ä»¥åï¼Œè®¾ä¸ªé—¹é’Ÿï¼Œä»¥å…åˆ°æ—¶å€™å¿˜äº†æœ‰è¿™å›äº‹äº†ã€‚

- ä½¿ç”¨ä¸‹é¢è¿™ä¸ªæŒ‡ä»¤æ£€æŸ¥å½“å‰æ˜¯å¦åŒæ­¥å®Œæˆäº†ã€‚
```bash
cd QKC-Miner && bash miner/stats_tool.sh
```
å¦‚æœçœ‹åˆ°åœ¨Syncingé‚£ä¸€æ æ˜¯falseå°±è¯´æ˜åŒæ­¥å®Œæˆäº†ï¼Œå¦åœ¨å°±å†ç­‰ç­‰å§ï¼
å¦‚æœæ˜¯ä¸‹é¢è¿™ç§çš„æ ·å­ï¼Œå°±è¯´åŒæ­¥å¥½äº†ï¼Œå°±å¯ä»¥å¼€å§‹å¯åŠ¨æŒ–çŸ¿äº†ã€‚
```bash
/code/pyquarkchain/quarkchain/tools#$ pypy3 stats -i 2 --ip localhost
QuarkChain Cluster Stats

CPU:                8
Memory:             16 GB
IP:                 localhost
Shards:             8
Network Id:         22
Peers:              35.231.158.99:38291, 104.248.77.137:38291

Timestamp             Syncing    ROOT SHARDS
2018-12-03 15:43:04     False      64 [425, 426, 470, 437, 440, 447, 387, 371]
2018-12-03 15:43:06     False      64 [425, 426, 470, 437, 440, 447, 387, 371]
2018-12-03 15:43:08     False      64 [425, 426, 470, 437, 440, 447, 387, 371]
2018-12-03 15:43:10     False      64 [426, 426, 470, 437, 440, 447, 387, 371]
2018-12-03 15:43:12     False      64 [427, 426, 470, 437, 441, 448, 387, 371]
```

#### å¯åŠ¨æŒ–çŸ¿
```bash
cd QKC-Miner && sudo bash miner/start_mining.sh
```

å› ä¸ºæ˜¯CPUæŒ–çŸ¿ï¼Œæ‰€ä»¥ä½¿ç”¨qkchashè¿›è¡ŒæŒ–çŸ¿ï¼Œä½¿ç”¨é»˜è®¤çš„åˆ†ç‰‡IDæ˜¯458753 å’Œ 393217ï¼Œé«˜çº§ä¸€ç‚¹ï¼Œå¦‚æœæƒ³è¦è‡ªå®šä¹‰ä½¿ç”¨å…¶ä»–åˆ†ç‰‡IDçš„è¯ä½¿ç”¨ä¸‹é¢è¿™è¡ŒæŒ‡ä»¤ã€‚
```bash
 sudo docker exec -it qkcminer python3 /code/pyquarkchain/quarkchain/tools/external_miner_manager.py --config $QKC_CONFIG --worker 1 --shard $Shard_ID
```
åˆ°è¿™é‡Œå°±ç»“æŸäº†ï¼Œè¿‡ä¸ªå‡ ä¸ªå°æ—¶å°±èƒ½å®˜ç½‘æˆ–è€…qPocketå½“ä¸­æŸ¥åˆ°æŒ–åˆ°çš„QKCäº†ã€‚
ç¥å¤§å®¶æŒ–çŸ¿æ„‰å¿«ã€‚
